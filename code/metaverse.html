<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="metaverse.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/1.0.11/pako.min.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "/node_modules/three/build/three.module.js",
                "stats.js": "/node_modules/stats.js/src/Stats.js",
                "cannon-es": "/node_modules/cannon-es/dist/cannon-es.js",
                "oimo": "/node_modules/oimo/build/oimo.module.js"
            }
        }
    </script>
    <script type="module" src="event.js"></script>
    <script type="module" src="record.js"></script>
    <title>GiO</title>
    <style>
        /* Your existing CSS styles */
        .hidden {
            display: none;
        }
    </style>

</head>
<body>
    <!-- 볼륨 조절 슬라이더 -->
    <input type="range" id="volumeSlider" min="0" max="100" value="50";>

    <div id="positionLabel" style="position: absolute; top: 10px; right: 10px; color: white; font-family: Arial; font-size: 16px; z-index: 99999;"></div>
    <div id = "tutorial">
        <div class="map_intro">
            <div class="tori"></div>
            <div class="tori_text_box">
                <div class="tori_tag npc_name">토리</div>
                <div class="tori_text">안녕! GiO 세계에 온걸 환영해!</div>
                <div class="tori_next next_btn"></div>
            </div>
            <div class="namebox">
                <div id="name_intro">이름을 입력하세요.</div>
                <input id="name_input" type="text" placeholder="입력한 이름으로 표시됩니다. (최대7자)">
                <button>확인</button>
            </div>
        </div>
    </div>
    <div class='tori_help'>
        <p>지도에 표시되어 있는<br>학교를 클릭해봐! 버스를 타고<br>학교로 이동할 수 있어!</p>
        <div class="next_btn"></div>
    </div>
    <div id="BtnMaps">
        <button id="buttonNo">X</button>
        <h1>어느 장소로 이동할까?</h1>
        <div>    
            <button id="buttonScene0" style="background-image: url(./data/mappage/school.png);">
                <!-- <div class="SceneTag">학교</div> -->
            </button>
            <button id="buttonScene1" style="background-image: url(./data/mappage/town.png);">
                <div class="SceneTag">마을회관</div>
            </button>
            <button id="buttonScene2" style="background-image: url(./data/mappage/library.png);">
                <div class="SceneTag">도서관</div>
            </button>
            <button id="buttonScene3" style="background-image: url(./data/mappage/mart.png);">
                <div class="SceneTag">공원</div>
            </button>
        </div>
    </div>
    <div id="webgl-container"></div>

            <!-- 모달 창 -->
            <div id="myModal" class="modal">
                <!-- 모달 콘텐츠 -->
                <div class="Speech1 textModal">
                    <span class="npc_name"></span>
                    <span class="close" id="close1" style="display: none;">&times;</span>
                    <p>거기 너! 나랑 공놀이 하지 않을래?</p>
                    <div class="choose" style="display: flex;">
                    <button class="GameBtn" id="Game" data-path="">좋아!</button>
                    <button class="GameBtn" onclick="document.getElementById('close1').click()">다음에 하자</button>
                    <button id="option1" style="display: none;">점수확인</button>
                    </div>
                    <!-- <button id="option2">점수기입</button> -->
                    <!-- <button id="recordButton">녹음 시작</button> -->
                </div>
            </div>    
            <!-- 유니티 게임 모달 -->
            <div id="gameModal" class="modal textModal">
                <div class="modal-content" id="game-content">
                    <span class="close" id="closeGameModal">&times;</span>
                    <iframe id="unityGame" src="" style="width:100%; height:100%;" frameborder="0"></iframe>
                </div>
            </div>

            <div id="thiscasher" class="casher textModal"> 
                <div class="Speech1">
                    <span class="npc_name"></span>
                    <p id="speechText">이것은 우리의 대화에 들어가는 것을 테스트 하는 것이에요.</p>
                    <button id="next" class="next_btn"></button>
                    <span class="close" id="casher_close" style="display: none;">&times;</span>
                    <div id="buttonGroup" class="choose" style="display: none;">
                        <button id ="select1">이렇게 할까?</button>
                        <button id ="select2">저렇게 할까?</button>
                        <button id ="select3">요렇게 할까?</button>
                        <button id="recordButton" style="display: none;">녹음 시작</button>
                    </div>
                    <div id="'helper" style="display: none;">
                        <div id="helper_text"></div>
                        <img src="/code/data/maru.png" alt="" id="helper_img">
                    </div>
                </div>
            </div>
            <div id="loadingPage">
                <!-- <div id="loadback">
                    <h1>Loading...</h1>
                    <div class="spinner"></div>
                </div> -->
                <img src="./data/loginImage/loadimg.png" alt="" id="loadimg">
            </div>
            
            <div id="loginModal" class="modal textModal">
                <div class="modal-content" id="loginContent">
                    <img src="./data/loginImage/logo.png" alt="Logo" id="login-logo">
                    <h2 id="main-login">로그인</h2>
                    <h2 onclick="switchToSignup()">회원가입</h2>
                    <h2>교육가이드</h2>
                    <h2>공지사항</h2>
                    
                </form>
                <span class="close" style="display: none;">&times;</span>
                <div id="intro">
                    <h3 style="font-size: 32px;">Growing Intercommunication Odyssey</h3>
                    <h4 style="font-size: 18px;">고기능 자폐 스펙트럼 아동들의 사회성 교육과 성장을 위한 사이트, GiO</h4>
                    <h4 style="font-size: 18px;">교육자들을 위한 보조와 아이들의 치료와 성장을 위해 GiO가 함께합니다.</h4>
                </div>
            </div>
                <div id="loginpage">
                    <h1 style="color: #373737;">로그인</h1>
                    <form id="loginForm">
                        <div style="display: flex; justify-content: center;">
                            <div id="loginBtns">
                                <input type="text" placeholder="아이디" name="id" required>
                                <br>
                                <input type="password" placeholder="비밀번호" name="password" required>
                            </div>
                            <button type="submit" id="loginBtn" style="color: #7E5001; font-weight: bolder;">로그인</button>
                        </div>
                    </br>
                        <!-- <button type="button" id = "regBtn"onclick="switchToSignup()">회원가입하기</button> -->
                        <button type = "button" id="findBtn"> ID/PW 찾기</button>
                    </form>
                </div>
                <div id="signupPage">
                    <form id="signupForm">
                        <h2 style="color: #373737;">회원가입</h2>
                        <div style="display: flex;">
                        <div>
                        <h4>이름</h4>
                        <input type="text" placeholder="예시) 홍길동" style="width: 140px;">
                        </div>
                        <div style="margin-left: 35px;">
                            <h4>성별</h4>
                            <div id="gender">

                                <input type="radio" id="male" name="gender" value="male">
                                <label for="male" class="genderbutton">남</label>
                                
                                <input type="radio" id="female" name="gender" value="female">
                                <label for="female" class="genderbutton">여</label>
                            </div>
                        </div>
                        </div>
                        <div>
                            <h4>생년월일</h4>
                            <input type="text" placeholder="년(4자)" style="width: 130px;">
                            <input type="text" placeholder="월" style="width: 77px;">
                            <input type="text" placeholder="일" style="width: 77px;">
                        </div>
                        <div>
                            <h4>아이디</h4>
                            <input type="text" placeholder="6~12자의 영문, 숫자만 사용가능합니다." name="id" required style="width: 333px;">
                        </div>
                        <div>
                            <h4>비밀번호</h4>
                            <input type="password" placeholder="6~12자의 영문, 숫자만 사용가능합니다." name="password" required style="width: 333px;">
                            <input type="password" placeholder="비밀번호를 다시 입력해주세요." name="confirmPassword" required style="width: 333px;">
                        </div>
                        <div>
                            <h4>이메일</h4>
                            <input type="email" placeholder="E-mail" style="width: 333px;">
                        </div>
                        <button type="submit" style="width: 352px;">가입하기</button>
                        <!-- <button type="button" onclick="switchToLogin()">로그인</button> -->
                    </form>
                    <div id="signupComplete">
                        <h1>회원가입이 완료되었습니다.</h1>
                        <button onclick="switchToLogin()">로그인하기</button>
                    </div>
                </div>
            </div>
            <div id="speechBubble" style="display: none; position: absolute; padding: 10px; background: white; border: 1px solid black; border-radius: 5px;">
                Hello, I'm an NPC!
            </div>









            

            

            <button id="openModal" onclick="openModal()" style="display: none;">마이페이지</button>
            
            <div id="pageModal" class="mypagemodal-bg"> 


                <!--메인창-->
                <div id="mypageMain">
                    <div class="index">
                        <img src="data/mypageimage/mypageim/bookmark_green.png" class="indexDefault index1 indexSelect">
                        <img src="data/mypageimage/mypageim/bookmark_pink.png" class="indexDefault index2 indexMove" style="z-index: -1;" onclick="showStickerTab()">
                        <img src="data/mypageimage/mypageim/bookmark_blue.png" class="indexDefault index3 indexMove" style="z-index: -2;">
                        <img src="data/mypageimage/mypageim/bookmark_yellow.png" class="indexDefault index4 indexMove" style="z-index: -3;" onclick="showSettingTab()">
                    </div>
                    <img src="data/mypageimage/mypageim/close_btn.png" class="closeIndex indexDefault indexMove" onclick="closeModal()">
                    <div id="note">
                        <div id="profileBox">
                            <img id="profileImg" src="data/mypageimage/mypageim/profile_img.png">
                            <div id="playerName">
                                <p>개척자</p>
                            </div>

                            <div id="profileBackground">
                                <div id="profileInfo">
                                    <div id="birthday" class="backgroundDefault">
                                        <div class="classification">
                                            <img id="B-icon" src="data/mypageimage/mypageim/birth_icon.png" width="25em" height="26em">
                                            <p>생일</p>
                                        </div>
                                        <div class="info">
                                            <p>2015.05.30</p>
                                        </div>
                                    </div>
                                    <div id="joindate" class="backgroundDefault">
                                        <div class="classification">
                                            <img id="B-icon" src="data/mypageimage/mypageim/enter_icon.png" width="25em" height="24em">
                                            <p>가입일</p>
                                        </div>
                                        <div class="info">
                                            <p>2024.07.01</p>
                                        </div>
                                    </div>
                                    <div id="visit" class="backgroundDefault">
                                        <div class="classification">
                                            <img id="B-icon" src="data/mypageimage/mypageim/visit_icon.png" width="25em" height="24em">
                                            <p>방문</p>
                                        </div>
                                        <div class="info">
                                            <p>37회</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div id="buttonBox">
                            <div id="stickerbook" class="selectOption" onclick="showStickerTab()">
                                <div id="textBox">
                                    <p id="optionTitle">스티커북</p>
                                    <p id="optioninfo">수집한 스티커를 확인할 수 있어요.</p>
                                </div>
                            </div>
                            <div id="system" class="selectOption" onclick="showSettingTab()">
                                <div id="textBox">
                                    <p id="optionTitle">설정</p>
                                    <p id="optioninfo">개인정보, 환경설정을 할 수 있어요.</p>
                                </div>
                            </div>
                            <div id="data" class="selectOption">
                                <div id="textBox">
                                    <p id="optionTitle">데이터</p>
                                    <p id="optioninfo">활동, 대화 점수를 확인할 수 있어요.</p>
                                </div>
                            </div>
                            <div id="buttonOption" class="selectOption">
                                <div id="twoButton">
                                    <div id="inputCode" class="buttonSetting">
                                        <img id="S-icon" src="data/mypageimage/mypageim/code_icon.png" width="24em" height="20em">
                                        <p class="fontSetting">코드 입력</p>
                                    </div>
                                    <div id="logout" class="buttonSetting">
                                        <img id="S-icon" src="data/mypageimage/mypageim/logout_icon.png" width="23em" height="25em">
                                        <p class="fontSetting">로그아웃</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <img src="data/mypageimage/mypageim/pencil.png" id="pencil">
                </div>



                <!--스티커북창-->
                <div id="StickerTab" class="tabcontent">
                    <div class="index">
                        <img src="data/mypageimage/mypageim/bookmark_green.png" class="indexDefault index1 indexMove">
                        <img src="data/mypageimage/mypageim/bookmark_pink.png" class="indexDefault index2 indexSelect" style="z-index: -1;">
                        <img src="data/mypageimage/mypageim/bookmark_blue.png" class="indexDefault index3 indexMove" style="z-index: -2;">
                        <img src="data/mypageimage/mypageim/bookmark_yellow.png" class="indexDefault index4 indexMove" style="z-index: -3;" onclick="showSettingTab()">
                    </div>
                    <img src="data/mypageimage/mypageim/close_btn.png" class="closeIndex indexDefault indexMove" onclick="closeModal()">
                    <div id="note">
                        <div class="pageTitleGroup">
                            <img src="data/mypageimage/mypageim/sticker_back.png">
                            <div class="pageTitle" style="background-image: url('data/mypageimage/mypageim/stickerbook_titile.png');">
                                <p>스티커북</p>
                            </div>
                        </div>
                    </div>
                    <img src="data/mypageimage/mypageim/pencil.png" id="pencil">
                </div>















                <!--설정창-->
                <div id="SettingTab" class="tabcontent">
                    <div class="index">
                        <img src="data/mypageimage/mypageim/bookmark_green.png" class="indexDefault index1 indexMove">
                        <img src="data/mypageimage/mypageim/bookmark_pink.png" class="indexDefault index2 indexMove" style="z-index: -1;" onclick="showStickerTab()">
                        <img src="data/mypageimage/mypageim/bookmark_blue.png" class="indexDefault index3 indexMove" style="z-index: -2;">
                        <img src="data/mypageimage/mypageim/bookmark_yellow.png" class="indexDefault index4 indexSelect" style="z-index: -3;">
                    </div>
                    <img src="data/mypageimage/mypageim/close_btn.png" class="closeIndex indexDefault indexMove" onclick="closeModal()">
                    <div id="note">
                        <div class="pageTitleGroup">
                            <img src="data/mypageimage/mypageim/system_back.png">
                            <div class="pageTitle" style="background-image: url('data/mypageimage/mypageim/system_titile.png');">
                                <p>설정</p>
                            </div>
                        </div>

                        <div id="settingInput">
                            <div id="rightPannel">
                                <form id="settingForm">
                                    <div class="inputBox">
                                        <h4 class="titleLabel">이름</h4>
                                        <input type="text" id="name" name="name" required style="width: 140px;">
                                    </div>
                                    <div class="inputBox">
                                        <h4>닉네임</h4>
                                        <input type="text" placeholder="예시) 홍길동" style="width: 140px;">
                                    </div>
                                    <div class="inputBox">
                                        <h4>아이디</h4>
                                        <input type="text" placeholder="예시) 홍길동" style="width: 140px;">
                                    </div>
                                </form>
                            </div>



                            <div id="leftPannel"></div>


                            
                        </div>

                        <div id="settingBut" class="buttonSetting">
                            <img id="SC-icon" src="data/mypageimage/mypageim/edit_icon.png" width="24em" height="25em">
                            <p class="fontSetting">수정하기</p>
                        </div>

                        

                    </div>
                    <img src="data/mypageimage/mypageim/pencil.png" id="pencil">
                </div>















                <div id="DataTab" class="tabcontent data">
                    <img src="data/mypageimage/mypageim/02.png" alt="">
                    <img id="activebtn" src="data/mypageimage/mypageim/activedata_btn00.png" alt="" onclick="showActiveTab()">
                    <img id="talkbtn" src="data/mypageimage/mypageim/talkdata_btn00.png" alt="" onclick="showTalkTab()">
                    <img id="closesticker2" src="data/mypageimage/mypageim/pageout_btn.png" alt="" onclick="closeModal()">
                </div>
                <div id="ActiveTab" class="tabcontent data">
                    <img src="data/mypageimage/mypageim/03.png" alt="">
                    <img id="schoolbtn" src="data/mypageimage/mypageim/school00.png" alt="" onclick="showSchoolTab()">
                    <img id="closesticker3" src="data/mypageimage/mypageim/pageout_btn.png" alt="" onclick="closeModal()">
                </div>
                <div id="TalkTab" class="tabcontent data">
                    <img src="data/mypageimage/mypageim/05.png" alt="">
                    <img id="communicationbtn" src="data/mypageimage/mypageim/communication00.png" alt="" onclick="showCommunicationTab()">
                    <img id="closesticker4" src="data/mypageimage/mypageim/pageout_btn.png" alt="" onclick="closeModal()">
                </div>
                <div id="SchoolTab" class="tabcontent data">
                    <img src="data/mypageimage/mypageim/04.png" alt="">
                    <img id="closesticker5" src="data/mypageimage/mypageim/pageout_btn.png" alt="" onclick="closeModal()">
                </div>
                <div id="CommunicationTab" class="tabcontent data">
                    <img src="data/mypageimage/mypageim/06.png" alt="">
                    <img id="closesticker6" src="data/mypageimage/mypageim/pageout_btn.png" alt="" onclick="closeModal()">
                </div>

            </div>
            <script>
                
                // 탭 히스토리를 관리할 배열
                var tabHistory = [];
                var modal = document.getElementById("pageModal");
                // 기본 초기화 함수
                function resetToInitialState() {
                    tabHistory = ['InitialState'];  // 기본 상태로 히스토리 초기화

                    var tabcontent = document.getElementsByClassName("tabcontent");
                    for (var i = 0; i < tabcontent.length; i++) {
                        tabcontent[i].style.display = "none";  // 모든 탭 숨기기
                    }

                    var images = document.querySelectorAll('#mypageMain *');
                    images.forEach(function(img) {
                        img.classList.remove('hidden');  // 모든 기본 이미지 표시
                    });
                }

                function openModal() {
                    var modal = document.getElementById('pageModal');
                    modal.style.display = 'flex';
                    resetToInitialState();  // 초기화 상태로 설정
                }

                function closeModal() {
                    var modal = document.getElementById('pageModal');
                    modal.style.display = 'none';
                    resetToInitialState();  // 모달을 닫을 때 초기화 상태로 설정
                }

                

                /*
                function showStickerTab() {
                    updateTabHistory('StickerTab');
                    var images = document.querySelectorAll('.image-container img'); //mypageMain로 바꿔야함
                    images.forEach(function(img) {
                        if (img.id !== 'bgim') {
                            img.classList.add('hidden');
                        }
                    });

                    openTab(null, 'StickerTab');
                }
                    */
            


                // 내가만들어서 수정중--------------------------------------------------------------
                function showStickerTab() {
                    updateTabHistory('StickerTab');
                    var elements = document.querySelectorAll('#mypageMain *'); //mypageMain로 바꿔야함
                    // 모든 요소 순회하면서 숨김 처리
                    elements.forEach(function(element) {
                        element.classList.add('hidden'); // 숨김 처리
                    });

                    openTab(null, 'StickerTab');
                }
                



                function showSettingTab() {
                    updateTabHistory('SettingTab');
                    var elements = document.querySelectorAll('#mypageMain *'); //mypageMain로 바꿔야함
                    // 모든 요소 순회하면서 숨김 처리
                    elements.forEach(function(element) {
                        element.classList.add('hidden'); // 숨김 처리
                    });

                    openTab(null, 'SettingTab');
                }



                //-------------------------------------------------------------------------------------

                function showDataTab() {
                    updateTabHistory('DataTab');
                    var images = document.querySelectorAll('.image-container img');
                    images.forEach(function(img) {
                        if (img.id !== 'bgim') {
                            img.classList.add('hidden');
                        }
                    });

                    openTab(null, 'DataTab');
                }
                function showActiveTab() {
                    updateTabHistory('ActiveTab');
                    var images = document.querySelectorAll('.image-container img');
                    images.forEach(function(img) {
                        if (img.id !== 'bgim') {
                            img.classList.add('hidden');
                        }
                    });

                    openTab(null, 'ActiveTab');
                }

                function showSchoolTab() {
                    updateTabHistory('SchoolTab');
                    var images = document.querySelectorAll('.image-container img');
                    images.forEach(function(img) {
                        if (img.id !== 'bgim') {
                            img.classList.add('hidden');
                        }
                    });

                    openTab(null, 'SchoolTab');
                }

                function showTalkTab() {
                    updateTabHistory('TalkTab');
                    var images = document.querySelectorAll('.image-container img');
                    images.forEach(function(img) {
                        if (img.id !== 'bgim') {
                            img.classList.add('hidden');
                        }
                    });

                    openTab(null, 'TalkTab');
                }

                function showCommunicationTab() {
                    updateTabHistory('CommunicationTab');
                    var images = document.querySelectorAll('.image-container img');
                    images.forEach(function(img) {
                        if (img.id !== 'bgim') {
                            img.classList.add('hidden');
                        }
                    });

                    openTab(null, 'CommunicationTab');
                }

                function updateTabHistory(currentTab) {
                    if (tabHistory[tabHistory.length - 1] !== currentTab) {
                        tabHistory.push(currentTab);
                    }
                }

                // Esc 키로 이전 탭으로 돌아가는 로직
                document.addEventListener('keydown', function(event) {
                    if (event.key === 'Escape') {
                        if (tabHistory.length > 1) {
                            var currentTab = tabHistory.pop();
                            var previousTab = tabHistory[tabHistory.length - 1];
                            openTab(null, previousTab);
                        } else {
                            resetToInitialState();  // 초기 상태로 돌아가기
                        }
                    }
                });

                // Function to open a specific tab
                // ---------------------------------------------------------------------------
                function openTab(evt, tabName) {
                    var tabcontent = document.getElementsByClassName("tabcontent");
                    for (var i = 0; i < tabcontent.length; i++) {
                        tabcontent[i].style.display = "none";
                    }

                    document.getElementById(tabName).style.display = "flex";
                    if (evt) {
                        evt.currentTarget.className += " active";
                    }
                }
                // ---------------------------------------------------------------------------------




                document.addEventListener("keydown", function(event) {
                    if (event.key === "B" || event.key === "b") {
                        if (modal.style.display === "none") {
                            openModal();
                        } else {
                            closeModal();
                        }
                    }
                });
                document.getElementById("logout").addEventListener("click", function() {
      location.reload(); // 페이지를 새로고침
       });
            </script>
            <script src="mypage.js"></script>
            <script type="module" src="login.js"></script>
</body>
</html>
